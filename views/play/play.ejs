<!doctype html>
<html lang="en">

    <%- include('../part/head') %>

    <body>
        <%- include('../part/nav') %>
            <div id="background"></div>
            <div class="container">
                <div class="d-flex justify-content-between align-items-center">
                    <% if (questionOrder - 1 >= 0) { %>
                    <a class="left" href="./<%=questionOrder-1%>" role="button">
                        <i class="fa fa-chevron-left" aria-hidden="true" style="font-size: xx-large;"></i>
                        <span class="sr-only">Previous</span>
                    </a>
                    <% } else { %> 
                    <div></div>
                    <% } %>

                    <div class="text-center flex-grow-1">
                        <h2>Câu hỏi <%= questionOrder + 1 %> / <%= questionOrderLength %> </h2>
                    </div>

                    <% if (parseInt(questionOrder) + 1 < questionOrderLength) { %>
                        <h1 class="text-center"><%=question.title%></h1>
                        <a class="left" href="./<%=parseInt(questionOrder) + 1%>" role="button">
                            <i class="fa fa-chevron-right" aria-hidden="true" style="font-size: xx-large;"></i>
                            <span class="sr-only">Next</span>
                        </a>
                    <% } else { %>
                        <div></div>
                    <% } %>
                </div>
                <p>
                    <%= question.text %>
                </p>

                <div class="text-center">
                    <% question.images.forEach(image => { %>
                        <img src="<%= image %>" alt="image" data-action="zoom" class="img-thumbnail">
                    <% }); %>

                </div>

                <div class="text-center">
                    <% question.ytVideoIds.forEach(id => { %>
                        <iframe width="560" height="315" src="<%=`https://www.youtube.com/embed/${id}`%>" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                    <% }); %>
                </div>

                <% if (isAnswered) { %> 
                    <h1 class="text-center">Bạn đã trả lời đúng câu hỏi này</h1>
                    <div class="form-group">
                        <textarea id="answer" class="form-control" rows="3" placeholder="Nhập câu trả lời của bạn" disabled><%= question.answer %></textarea>
                    </div>
                <% } else { %>
                    <h1 class="text-center">Trả lời</h1>
                    <div class="form-group">
                        <textarea id="answer" class="form-control" rows="3" placeholder="Nhập câu trả lời của bạn"></textarea>
                    </div>
                    <div class="text-center">
                        <a href="javascript:void(0);" class="fantasy-btn" onclick="sendAnswer()">Xác nhận</a>
                    </div>
                <% } %>


            </div>
    </body>

<%- include('../part/foot') %>

<% if (!isAnswered) { %> 
<script>
    function sendAnswer() {
        var userAnswer = document.getElementById("answer").value;

        if (userAnswer === "") {
            alert("Vui lòng nhập câu trả lời");
            return;
        }

        fetch('/answer', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                "CSRF-Token": Cookies.get("XSRF-TOKEN"),
            },
            body: JSON.stringify({
                questionId: `<%= questionId %>`,
                userAnswer
            })
        }).then(resp => resp.json())
        .then(data => {
            if (data.code === "CORRECT") {
                window.location.reload();
            } else if (data.code === "WRONG") {
                alert("Câu trả lời không đúng");
            }
        });
    }
</script>
<% }  %>

</html>